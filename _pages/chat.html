---
permalink: /chat.html
layout: null
title: "大模型对话页面"
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天页面</title>
</head>
<body>
    <div id="main-container">
  <!-- 历史记录栏 -->
  <div id="history-sidebar">
    <h3>历史记录</h3>
    <div id="history-list"></div>
    <button id="clear-all-history">清除全部历史</button>
  </div>
  <!-- 聊天主区域 -->
  <div id="chat-main">
    <div id="chat-container">
      <!-- 大模型选择下拉菜单 -->
      <select id="model-select">
        <option value="Qwen/Qwen2.5-72B-Instruct" selected>Qwen2.5-72B-Instruct</option>
        <option value="Pro/deepseek-ai/DeepSeek-V3">Pro/deepseek-ai/DeepSeek-V3</option>
      </select>
      <!-- 对话消息显示区域 -->
      <div id="chat-messages"></div>
      <!-- 输入框 -->
      <input type="text" id="user-input" placeholder="输入你的问题...">
      <!-- 发送按钮 -->
      <button id="send-button">发送</button>
      <!-- 清除当前会话历史记录按钮 -->
      <button id="clear-history">清除当前会话</button>
      <a href="/" class="back-button">返回首页</a>
    </div>
  </div>
</div>

<script>
// 确保 DOM 加载完成后执行代码
document.addEventListener('DOMContentLoaded', function() {
  try {
    // 获取 DOM 元素
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const modelSelect = document.getElementById('model-select');
    const clearHistoryButton = document.getElementById('clear-history');
    const historyList = document.getElementById('history-list');
    const clearAllHistoryButton = document.getElementById('clear-all-history');

    // 检查元素是否成功获取
    if (!chatMessages || !userInput || !sendButton || !modelSelect || !clearHistoryButton || !historyList || !clearAllHistoryButton) {
      console.error('部分 DOM 元素获取失败，请检查 HTML 结构');
      return;
    }

    let currentChatId = Date.now();
    let chatSessions = JSON.parse(localStorage.getItem('chatSessions')) || {};

    // 加载历史记录
    function loadHistory() {
      historyList.innerHTML = '';
      Object.entries(chatSessions).forEach(([chatId, session]) => {
        const historyItem = document.createElement('div');
        historyItem.classList.add('history-item');
        historyItem.dataset.chatId = chatId;
        historyItem.innerHTML = `
          <h4>${session.title}</h4>
          <p>${new Date(chatId).toLocaleString()}</p>
        `;
        historyItem.addEventListener('click', () => loadSession(chatId));
        historyList.appendChild(historyItem);
      });
    }

    // 加载会话
    function loadSession(chatId) {
      currentChatId = chatId;
      chatMessages.innerHTML = chatSessions[chatId].messages;
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // 保存当前会话
    function saveSession() {
      const title = chatSessions[currentChatId]?.title || generateTitle();
      chatSessions[currentChatId] = {
        title,
        messages: chatMessages.innerHTML
      };
      localStorage.setItem('chatSessions', JSON.stringify(chatSessions));
      loadHistory();
    }

    // 生成会话标题
    function generateTitle() {
      const userMessages = Array.from(chatMessages.querySelectorAll('.user'));
      if (userMessages.length > 0) {
        const firstMessage = userMessages[0].textContent;
        return firstMessage.substring(0, 20) + (firstMessage.length > 20 ? '...' : '');
      }
      return '新会话';
    }

    // 发送消息函数
    function sendMessage() {
      const message = userInput.value.trim();
      if (!message) {
        console.log('消息为空，不发送');
        return;
      }

      console.log('准备发送消息:', message);

      // 禁用输入和发送按钮，防止重复发送
      userInput.disabled = true;
      sendButton.disabled = true;

      // 显示用户消息
      appendMessage('user', message);

      const selectedModel = modelSelect.value;
      console.log('选中的模型:', selectedModel);

      fetch('https://api.siliconflow.cn/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer sk-uaqwrwlwdbconrtgnybuseuzrejvjjymexblmbeedimdrncl'
        },
        body: JSON.stringify({
          model: selectedModel,
          messages: [
            {
              role: 'user',
              content: message
            }
          ]
        })
      })
      .then(response => {
        console.log('响应状态:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('响应数据:', data);
        appendMessage('bot', data.choices[0].message.content);
      })
      .catch(error => {
        console.error('Fetch error:', error);
        console.log('完整错误信息:', error.stack);
        appendMessage('bot', '抱歉，发生错误，请稍后再试。');
      })
      .finally(() => {
        // 恢复输入和发送按钮
        userInput.disabled = false;
        sendButton.disabled = false;
        userInput.value = '';
        userInput.focus();
      });
    }

    // 追加消息到聊天区域
    function appendMessage(sender, text) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', sender);
      messageElement.textContent = text;
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      saveSession();
    }

    // 清除当前会话历史记录
    function clearHistory() {
      chatMessages.innerHTML = '';
      currentChatId = Date.now();
      saveSession();
    }

    // 清除全部历史记录
    function clearAllHistory() {
      chatSessions = {};
      localStorage.removeItem('chatSessions');
      chatMessages.innerHTML = '';
      currentChatId = Date.now();
      loadHistory();
    }

    // 页面加载时加载历史记录
    loadHistory();

    // 绑定事件
    sendButton.addEventListener('click', function(e) {
      e.preventDefault();
      sendMessage();
    });
    
    sendButton.addEventListener('touchstart', function(e) {
      e.preventDefault();
      sendMessage();
    });
    
    userInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });
    clearHistoryButton.addEventListener('click', clearHistory);
    clearHistoryButton.addEventListener('touchstart', (e) => {
      e.preventDefault();
      clearHistory();
    });
    clearAllHistoryButton.addEventListener('click', clearAllHistory);
    clearAllHistoryButton.addEventListener('touchstart', (e) => {
      e.preventDefault();
      clearAllHistory();
    });
  } catch (error) {
    console.error('初始化脚本时出错:', error);
  }
});
</script>

<style>
  #main-container {
    display: flex;
    height: 100vh;
  }

  #history-sidebar {
    width: 300px;
    padding: 20px;
    border-right: 1px solid #ccc;
    overflow-y: auto;
  }

  #chat-main {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }

  #chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  #chat-messages {
    border: 1px solid #ccc;
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
  }

  /* 移动端样式优化 */
  @media (max-width: 768px) {
    #main-container {
      flex-direction: column;
    }

    #history-sidebar {
      width: 100%;
      border-right: none;
      border-bottom: 1px solid #ccc;
      max-height: 200px;
    }

    #chat-main {
      padding: 10px;
    }

    #chat-container {
      flex: 1;
    }

    #chat-messages {
      height: 60vh;
    }

    #user-input,
    #send-button,
    #clear-history {
      margin-top: 5px;
    }
  }

  /* 为下拉菜单添加样式 */
  #model-select {
    margin-bottom: 10px;
    padding: 5px;
  }

  /* 统一按钮样式 */
  #send-button,
  #clear-history,
  #clear-all-history {
    margin-top: 10px;
    padding: 10px 20px; /* 统一内边距 */
    border: none; /* 去除边框 */
    border-radius: 20px; /* 圆角矩形 */
    cursor: pointer; /* 鼠标悬停显示手型 */
    font-size: 14px; /* 统一字体大小 */
    transition: opacity 0.3s; /* 添加透明度过渡效果 */
  }

  #send-button {
    background-color:rgb(100, 189, 48); /* 绿色背景 */
    color: white; /* 白色文字 */
  }

  #clear-history,
  #clear-all-history {
    background-color:rgb(244, 139, 54); /* 红色背景 */
    color: white; /* 白色文字 */
  }

  /* 按钮悬停效果 */
  #send-button:hover,
  #clear-history:hover,
  #clear-all-history:hover {
    opacity: 0.8; /* 悬停时透明度降低 */
  }

  .history-item {
    cursor: pointer;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #eee;
    border-radius: 5px;
  }

  .history-item:hover {
    background-color: #f5f5f5;
  }

  /* 返回按钮样式 */
  .back-button {
      display: inline-block;
      color: white;
      background-color: #6c757d;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 4px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin: 20px 0;
      border: none;
      font-weight: normal;
  }
  
  .back-button:hover {
      background-color: #5a6268;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transform: translateY(-1px);
  }
</style>
</body>
</html>