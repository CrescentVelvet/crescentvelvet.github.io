---
permalink: /game.html
layout: null
title: "é£æœºå¤§æˆ˜å°æ¸¸æˆ"
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£æœºå¤§æˆ˜å°æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #0a0a2a; /* æ·±è“è‰²èƒŒæ™¯ */
            touch-action: none;
            font-family: 'Arial', sans-serif;
            background-image: linear-gradient(to bottom, #0a0a2a, #000000); /* æ¸å˜èƒŒæ™¯ */
        }
        canvas {
            border: 3px solid #4a90e2;
            border-radius: 10px;
            max-width: 100vw;
            max-height: 100vh;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5); /* å‘å…‰æ•ˆæœ */
        }
        #gameInfo {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 16px;
            font-family: 'Arial', sans-serif;
            line-height: 1.5;
            z-index: 100;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        #gameInfo div {
            margin-bottom: 5px;
        }
        #gameInfo span {
            font-weight: bold;
            color: #4a90e2;
        }
        #lastModified {
            position: fixed;
            top: 10px;
            right: 10px;
            color: #fff;
            font-size: 14px;
            font-family: 'Arial', sans-serif;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 100;
        }
        .game-controls {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 10px;
            z-index: 1000;
        }
        .control-btn {
            background: rgba(74, 144, 226, 0.3);
            border: 2px solid rgba(74, 144, 226, 0.7);
            color: white;
            padding: 15px;
            border-radius: 50%; /* åœ†å½¢æŒ‰é’® */
            min-width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            touch-action: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            transition: all 0.2s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        }
        .control-btn:active {
            background: rgba(74, 144, 226, 0.7);
            transform: scale(0.95); /* æŒ‰ä¸‹æ—¶ç¼©å°æ•ˆæœ */
        }
        .control-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="gameInfo">
        <div>ç”Ÿå‘½å€¼: <span id="lives">3</span></div>
        <div>å‡»æ€æ•°: <span id="kills">0</span></div>
        <div>æ—¶é—´: <span id="time">0</span></div>
        <div>åˆ†æ•°: <span id="score">0</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div id="mobileControls">
        <button class="control-btn" id="leftBtn">â†</button>
        <button class="control-btn" id="fireBtn">ğŸ”¥</button>
        <button class="control-btn" id="rightBtn">â†’</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const livesElement = document.getElementById('lives');
        const killsElement = document.getElementById('kills');
        const timeElement = document.getElementById('time');
        const scoreElement = document.getElementById('score');

        // è®¾ç½®ç”»å¸ƒå¤§å°
        canvas.width = 400;
        canvas.height = 600;

        // æ¸¸æˆçŠ¶æ€
        let score = 0;
        let lives = 3;
        let kills = 0;
        let gameTime = 0;
        let gameOver = false;
        let gamePaused = false; // æ·»åŠ æš‚åœçŠ¶æ€å˜é‡
        let startTime = Date.now();
        let powerUpActive = false;
        let powerUpTimeLeft = 0;
        let powerUpDuration = 5000; // ç‰¹æ®Šèƒ½åŠ›æŒç»­5ç§’
        let invinciblePowerUpActive = false; // æ— æ•Œç‰¹æ®Šèƒ½åŠ›çŠ¶æ€
        let invinciblePowerUpTimeLeft = 0; // æ— æ•Œç‰¹æ®Šèƒ½åŠ›å‰©ä½™æ—¶é—´
        let invinciblePowerUpDuration = 3000; // æ— æ•Œç‰¹æ®Šèƒ½åŠ›æŒç»­3ç§’
        let enemyCounter = 0; // æ•Œäººè®¡æ•°å™¨
        let lastBulletTime = 0; // ä¸Šæ¬¡å‘å°„å­å¼¹çš„æ—¶é—´
        const bulletCooldown = 300; // å­å¼¹å‘å°„å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        let explosions = []; // çˆ†ç‚¸æ•ˆæœæ•°ç»„

        // é‡‘è‰²æ–¹å—æ•°ç»„
        let powerUps = [];

        // è“è‰²æ–¹å—æ•°ç»„ï¼ˆæ— æ•Œå¥–åŠ±ï¼‰
        let invinciblePowerUps = [];
        // å­å¼¹æ•°ç»„
        let bullets = [];
        const bulletSpeed = 7;

        // æ•Œæœºæ•°ç»„
        let enemies = [];
        const enemySpeed = 3;

        // ç»˜åˆ¶æ˜Ÿæ˜ŸèƒŒæ™¯
        function drawStars() {
            // ä½¿ç”¨å›ºå®šçš„éšæœºç§å­ï¼Œè¿™æ ·æ˜Ÿæ˜Ÿä½ç½®ä¸ä¼šæ¯å¸§éƒ½å˜
            const starCount = 100;
            const starSeed = Math.floor(gameTime / 10); // æ¯10ç§’å˜åŒ–ä¸€æ¬¡æ˜Ÿç©º
            
            // ç®€å•çš„ä¼ªéšæœºå‡½æ•°
            const pseudoRandom = (seed, index) => {
                return ((seed * 9301 + 49297) * index) % 233280 / 233280;
            };
            
            for (let i = 0; i < starCount; i++) {
                const x = pseudoRandom(starSeed, i * 3) * canvas.width;
                const y = pseudoRandom(starSeed, i * 3 + 1) * canvas.height;
                const size = 1 + pseudoRandom(starSeed, i * 3 + 2) * 2;
                
                // è®©æ˜Ÿæ˜Ÿé—ªçƒ
                const brightness = 0.5 + Math.sin(gameTime + i) * 0.5;
                const alpha = 0.5 + brightness * 0.5;
                
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ç»˜åˆ¶æ˜Ÿå½¢ï¼ˆç”¨äºé‡‘è‰²æ–¹å—ï¼‰
        function drawStar(cx, cy, radius, spikes) {
            let rot = Math.PI / 2 * 3;
            let step = Math.PI / spikes;
            
            ctx.beginPath();
            ctx.moveTo(cx, cy - radius);
            
            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(
                    cx + Math.cos(rot) * radius,
                    cy + Math.sin(rot) * radius
                );
                rot += step;
                
                ctx.lineTo(
                    cx + Math.cos(rot) * radius * 0.4,
                    cy + Math.sin(rot) * radius * 0.4
                );
                rot += step;
            }
            
            ctx.lineTo(cx, cy - radius);
            ctx.closePath();
            ctx.fill();
        }

        // ç»˜åˆ¶ç›¾ç‰Œå½¢çŠ¶ï¼ˆç”¨äºæ— æ•Œå¥–åŠ±ï¼‰
        function drawShield(cx, cy, radius) {
            ctx.beginPath();
            ctx.moveTo(cx, cy - radius);
            ctx.quadraticCurveTo(
                cx + radius, cy - radius * 0.8,
                cx + radius, cy
            );
            ctx.quadraticCurveTo(
                cx + radius, cy + radius,
                cx, cy + radius
            );
            ctx.quadraticCurveTo(
                cx - radius, cy + radius,
                cx - radius, cy
            );
            ctx.quadraticCurveTo(
                cx - radius, cy - radius * 0.8,
                cx, cy - radius
            );
            ctx.closePath();
            ctx.fill();
            
            // æ·»åŠ ç›¾ç‰Œå†…éƒ¨ç»†èŠ‚
            ctx.beginPath();
            ctx.moveTo(cx, cy - radius * 0.4);
            ctx.lineTo(cx, cy + radius * 0.4);
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(cx - radius * 0.4, cy);
            ctx.lineTo(cx + radius * 0.4, cy);
            ctx.stroke();
        }

        // åˆ›å»ºæ•Œæœº
        function createEnemy() {
            if (Math.random() < 0.02) {
                // æ ¹æ®æ¸¸æˆæ—¶é—´å’Œéšæœºå› ç´ å†³å®šæ•Œæœºç­‰çº§
                let level = 1;
                // æ¸¸æˆæ—¶é—´è¶Šé•¿ï¼Œå‡ºç°é«˜ç­‰çº§æ•Œæœºçš„æ¦‚ç‡è¶Šé«˜
                if (gameTime > 30) {
                    level = Math.floor(Math.random() * 3) + 1; // 1-3çº§
                } else if (gameTime > 15) {
                    level = Math.floor(Math.random() * 2) + 1; // 1-2çº§
                }
                
                // æ ¹æ®ç­‰çº§è®¾ç½®æ•Œæœºå±æ€§
                const enemyWidth = 30 + (level - 1) * 10; // ç­‰çº§è¶Šé«˜ï¼Œæ•Œæœºè¶Šå¤§ï¼Œå¢åŠ ä½“ç§¯å·®å¼‚
                const enemyHeight = 30 + (level - 1) * 10;
                const enemySpeed = 4 - (level - 1); // ç­‰çº§è¶Šé«˜ï¼Œé€Ÿåº¦è¶Šæ…¢
                
                enemies.push({
                    x: Math.random() * (canvas.width - enemyWidth),
                    y: -enemyHeight,
                    width: enemyWidth,
                    height: enemyHeight,
                    level: level, // æ•Œæœºç­‰çº§
                    speed: enemySpeed // æ•Œæœºé€Ÿåº¦
                });
                enemyCounter++; // æ¯åˆ›å»ºä¸€ä¸ªæ•Œäººå°±è®¡æ•°
                
                // æ¯å½“æ•Œäººæ•°é‡è¾¾åˆ°10çš„å€æ•°æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªé‡‘è‰²æ–¹å—
                if (enemyCounter % 10 === 0) {
                    powerUps.push({
                        x: Math.random() * (canvas.width - 20),
                        y: -20,
                        width: 20,
                        height: 20,
                        speed: 2
                    });
                }
            }
        }

        // æ›´æ–°æ•Œæœºä½ç½®
        function updateEnemies() {
            enemies = enemies.filter(enemy => {
                enemy.y += enemy.speed; // ä½¿ç”¨æ•Œæœºè‡ªèº«çš„é€Ÿåº¦
                return enemy.y < canvas.height;
            });
        }

        // ç¢°æ’æ£€æµ‹
        function checkCollisions() {
            // å­å¼¹å‡»ä¸­æ•Œæœº
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                let bulletHit = false;
                
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const enemy = enemies[j];
                    if (bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y) {
                        
                        // é™ä½æ•Œæœºç­‰çº§
                        enemy.level--;
                        
                        // æ›´æ–°æ•Œæœºä½“ç§¯å’Œé€Ÿåº¦
                        enemy.width = 30 + (enemy.level - 1) * 10;
                        enemy.height = 30 + (enemy.level - 1) * 10;
                        enemy.speed = 4 - (enemy.level - 1);
                        
                        // åˆ›å»ºå°çˆ†ç‚¸æ•ˆæœ
                        createExplosion(
                            bullet.x + bullet.width / 2,
                            bullet.y + bullet.height / 2,
                            10,
                            bullet.color || '#fff'
                        );
                        
                        // å¦‚æœæ•Œæœºç­‰çº§é™ä¸º0ï¼Œåˆ™ç§»é™¤æ•Œæœºå¹¶å¢åŠ åˆ†æ•°
                        if (enemy.level <= 0) {
                            // åˆ›å»ºå¤§çˆ†ç‚¸æ•ˆæœ
                            createExplosion(
                                enemy.x + enemy.width / 2,
                                enemy.y + enemy.height / 2,
                                enemy.width,
                                '#ff0000'
                            );
                            
                            // ç§»é™¤è¢«å‡»ä¸­çš„æ•Œæœº
                            enemies.splice(j, 1);
                            // å¢åŠ åˆ†æ•°å’Œå‡»æ€æ•°
                            score += 100;
                            kills++;
                            scoreElement.textContent = score;
                            killsElement.textContent = kills;
                        }
                        
                        // æ ‡è®°å­å¼¹å·²å‡»ä¸­æ•Œæœº
                        bulletHit = true;
                        break; // ä¸€æ—¦å‡»ä¸­æ•Œæœºå°±è·³å‡ºå†…å±‚å¾ªç¯
                    }
                }
                
                // å¦‚æœå­å¼¹å‡»ä¸­äº†æ•Œæœºï¼Œåˆ™ç§»é™¤è¯¥å­å¼¹
                if (bulletHit) {
                    bullets.splice(i, 1);
                }
            }

                    // ç©å®¶ç¢°åˆ°é‡‘è‰²æ–¹å—
                    powerUps.forEach((powerUp, index) => {
                        if (player.x < powerUp.x + powerUp.width &&
                            player.x + player.width > powerUp.x &&
                            player.y < powerUp.y + powerUp.height &&
                            player.y + player.height > powerUp.y) {
                            // ç§»é™¤é‡‘è‰²æ–¹å—
                            powerUps.splice(index, 1);
                            // æ¿€æ´»ç‰¹æ®Šèƒ½åŠ›
                            powerUpActive = true;
                            powerUpTimeLeft = 5000; // 5ç§’ç‰¹æ®Šèƒ½åŠ›æ—¶é—´
                            player.speed = 8; // æå‡ç§»åŠ¨é€Ÿåº¦
                        }
                    });

                    // ç©å®¶ç¢°åˆ°è“è‰²æ–¹å—ï¼ˆæ— æ•Œå¥–åŠ±ï¼‰
                    invinciblePowerUps.forEach((powerUp, index) => {
                        if (player.x < powerUp.x + powerUp.width &&
                            player.x + player.width > powerUp.x &&
                            player.y < powerUp.y + powerUp.height &&
                            player.y + player.height > powerUp.y) {
                            // ç§»é™¤è“è‰²æ–¹å—
                            invinciblePowerUps.splice(index, 1);
                            // æ¿€æ´»æ— æ•Œç‰¹æ®Šèƒ½åŠ›
                            invinciblePowerUpActive = true;
                            invinciblePowerUpTimeLeft = invinciblePowerUpDuration; // 3ç§’æ— æ•Œæ—¶é—´
                            player.invincible = true; // è®¾ç½®ç©å®¶ä¸ºæ— æ•ŒçŠ¶æ€
                        }
                    });

                    // æ•Œæœºæ’å‡»ç©å®¶
                    if (!player.invincible) {
                        for (let i = enemies.length - 1; i >= 0; i--) {
                            const enemy = enemies[i];
                            if (player.x < enemy.x + enemy.width &&
                                player.x + player.width > enemy.x &&
                                player.y < enemy.y + enemy.height &&
                                player.y + player.height > enemy.y) {
                                
                                // é™ä½æ•Œæœºç­‰çº§
                                enemy.level--;
                                
                                // æ›´æ–°æ•Œæœºä½“ç§¯å’Œé€Ÿåº¦
                                enemy.width = 30 + (enemy.level - 1) * 10;
                                enemy.height = 30 + (enemy.level - 1) * 10;
                                enemy.speed = 4 - (enemy.level - 1);
                                
                                // å¦‚æœæ•Œæœºç­‰çº§é™ä¸º0ï¼Œåˆ™ç§»é™¤æ•Œæœº
                                if (enemy.level <= 0) {
                                    enemies.splice(i, 1);
                                }
                                
                                // ç©å®¶å—åˆ°ä¼¤å®³
                                lives--;
                                livesElement.textContent = lives;
                                if (lives <= 0) {
                                    gameOver = true;
                                } else {
                                    // è®¾ç½®æ— æ•ŒçŠ¶æ€
                                    player.invincible = true;
                                    setTimeout(() => {
                                        player.invincible = false;
                                    }, player.invincibleTime);
                                }
                            }
                        }
                    }
                }

        // åˆ›å»ºé‡‘è‰²æ–¹å—
        function createPowerUp() {
            // åªåœ¨enemyCounteræ˜¯10çš„å€æ•°ï¼Œä¸”å¤§äº0æ—¶åˆ›å»ºä¸€ä¸ªé‡‘è‰²æ–¹å—
            if (enemyCounter % 10 === 0 && enemyCounter > 0 && powerUps.length === 0) {
                powerUps.push({
                    x: Math.random() * (canvas.width - 20),
                    y: -20,
                    width: 20,
                    height: 20,
                    speed: 2
                });
            }
        }

        // åˆ›å»ºè“è‰²æ–¹å—ï¼ˆæ— æ•Œå¥–åŠ±ï¼‰
        function createInvinciblePowerUp() {
            // æ¯å½“æ•Œäººæ•°é‡è¾¾åˆ°15çš„å€æ•°æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªè“è‰²æ–¹å—
            if (enemyCounter % 15 === 0 && enemyCounter > 0 && invinciblePowerUps.length === 0) {
                invinciblePowerUps.push({
                    x: Math.random() * (canvas.width - 20),
                    y: -20,
                    width: 20,
                    height: 20,
                    speed: 2
                });
            }
        }

        // æ›´æ–°é‡‘è‰²æ–¹å—ä½ç½®
        function updatePowerUps() {
            powerUps = powerUps.filter(powerUp => {
                powerUp.y += powerUp.speed;
                return powerUp.y < canvas.height;
            });

            // æ›´æ–°ç‰¹æ®Šèƒ½åŠ›æ—¶é—´
            if (powerUpActive) {
                powerUpTimeLeft = Math.max(0, powerUpTimeLeft - 16); // å‡è®¾60fpsï¼Œçº¦16msæ¯å¸§
                if (powerUpTimeLeft <= 0) {
                    powerUpActive = false;
                    player.speed = 5; // æ¢å¤æ­£å¸¸é€Ÿåº¦
                }
            }
        }

        // æ›´æ–°è“è‰²æ–¹å—ä½ç½®
        function updateInvinciblePowerUps() {
            invinciblePowerUps = invinciblePowerUps.filter(powerUp => {
                powerUp.y += powerUp.speed;
                return powerUp.y < canvas.height;
            });
        
            // æ›´æ–°æ— æ•Œç‰¹æ®Šèƒ½åŠ›æ—¶é—´
            if (invinciblePowerUpActive) {
                invinciblePowerUpTimeLeft = Math.max(0, invinciblePowerUpTimeLeft - 16); // å‡è®¾60fpsï¼Œçº¦16msæ¯å¸§
                if (invinciblePowerUpTimeLeft <= 0) {
                    invinciblePowerUpActive = false;
                    player.invincible = false; // æ— æ•ŒçŠ¶æ€ç»“æŸ
                }
            }
        }

        // ç©å®¶é£æœº
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 40,
            height: 40,
            speed: 5,
            invincible: false,
            invincibleTime: 2000 // æ— æ•Œæ—¶é—´2ç§’
        };

        // æŒ‰é”®çŠ¶æ€
        const keys = {
            ArrowLeft: false,
            ArrowRight: false,
            ArrowUp: false,
            ArrowDown: false,
            Space: false,
            KeyA: false,
            KeyD: false,
            KeyW: false,
            KeyS: false
        };

        // ç›‘å¬é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', (e) => {
            if (e.code in keys) {
                keys[e.code] = true;
                
                // ç©ºæ ¼é”®ç”¨äºæš‚åœ/ç»§ç»­æ¸¸æˆ
                if (e.code === 'Space' && !gameOver) {
                    gamePaused = !gamePaused;
                    
                    // å¦‚æœç»§ç»­æ¸¸æˆï¼Œæ›´æ–°å¼€å§‹æ—¶é—´ä»¥é¿å…æ—¶é—´è·³è·ƒ
                    if (!gamePaused) {
                        const pauseDuration = Date.now() - pauseStartTime;
                        startTime += pauseDuration;
                    } else {
                        let pauseStartTime = 0; // è®°å½•æš‚åœå¼€å§‹çš„æ—¶é—´
                        pauseStartTime = Date.now();
                    }
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code in keys) {
                keys[e.code] = false;
            }
        });

        // æ›´æ–°ç©å®¶ä½ç½®
        function updatePlayer() {
            if (keys.ArrowLeft && player.x > 0) {
                player.x -= player.speed;
            }
            if (keys.ArrowRight && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }
            if (keys.ArrowUp && player.y > 0) {
                player.y -= player.speed;
            }
            if (keys.ArrowDown && player.y < canvas.height - player.height) {
                player.y += player.speed;
            }
        }

        // åˆ›å»ºå­å¼¹
        function createBullet() {
            const currentTime = Date.now();
            // è‡ªåŠ¨å‘å°„å­å¼¹ï¼Œåªéœ€æ£€æŸ¥å†·å´æ—¶é—´
            if (currentTime - lastBulletTime > bulletCooldown) {
                // æ›´æ–°ä¸Šæ¬¡å‘å°„æ—¶é—´
                lastBulletTime = currentTime;
                
                // æ ¹æ®ç‰¹æ®Šèƒ½åŠ›çŠ¶æ€å†³å®šå­å¼¹é¢œè‰²
                const bulletColor = powerUpActive ? '#FFD700' : '#fff';
                
                // åˆ›å»ºä¸­é—´çš„å­å¼¹
                bullets.push({
                    x: player.x + player.width / 2 - 2,
                    y: player.y,
                    width: 4,
                    height: 10,
                    dx: 0, // æ°´å¹³é€Ÿåº¦åˆ†é‡
                    color: bulletColor // æ·»åŠ é¢œè‰²å±æ€§
                });
        
                // å¦‚æœç‰¹æ®Šèƒ½åŠ›æ¿€æ´»ï¼Œåˆ›å»ºæ–œå‘å­å¼¹
                if (powerUpActive) {
                    // å·¦æ–œå‘å­å¼¹
                    bullets.push({
                        x: player.x + player.width / 2 - 2,
                        y: player.y,
                        width: 4,
                        height: 10,
                        dx: -2, // å‘å·¦çš„é€Ÿåº¦åˆ†é‡
                        color: bulletColor // æ·»åŠ é¢œè‰²å±æ€§
                    });
        
                    // å³æ–œå‘å­å¼¹
                    bullets.push({
                        x: player.x + player.width / 2 - 2,
                        y: player.y,
                        width: 4,
                        height: 10,
                        dx: 2, // å‘å³çš„é€Ÿåº¦åˆ†é‡
                        color: bulletColor // æ·»åŠ é¢œè‰²å±æ€§
                    });
                }
            }
        }

        // æ›´æ–°å­å¼¹ä½ç½®
        function updateBullets() {
            bullets = bullets.filter(bullet => {
                bullet.y -= bulletSpeed;
                bullet.x += bullet.dx || 0; // æ·»åŠ æ°´å¹³ç§»åŠ¨
                // å­å¼¹åœ¨ç”»å¸ƒèŒƒå›´å†…æ‰ä¿ç•™
                return bullet.y > 0 && bullet.x > 0 && bullet.x < canvas.width;
            });
        }

        // åœ¨drawå‡½æ•°ä¸­æ›´æ–°å­å¼¹ç»˜åˆ¶
        function draw() {
            // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
            ctx.fillStyle = '#0a0a2a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸€äº›éšæœºçš„æ˜Ÿæ˜Ÿ
            drawStars();
            
            // ç»˜åˆ¶ç©å®¶ï¼ˆæ— æ•ŒçŠ¶æ€é—ªçƒï¼‰
            if (!player.invincible || Math.floor(Date.now() / 100) % 2) {
                // åˆ›å»ºç©å®¶é£æœºçš„æ¸å˜è‰²
                const playerGradient = ctx.createLinearGradient(
                    player.x, player.y, 
                    player.x, player.y + player.height
                );
                playerGradient.addColorStop(0, '#00ff00');
                playerGradient.addColorStop(1, '#006600');
                
                ctx.fillStyle = playerGradient;
                
                // ç»˜åˆ¶é£æœºä¸»ä½“
                ctx.beginPath();
                ctx.moveTo(player.x + player.width / 2, player.y);
                ctx.lineTo(player.x, player.y + player.height);
                ctx.lineTo(player.x + player.width, player.y + player.height);
                ctx.closePath();
                ctx.fill();
                
                // ç»˜åˆ¶é£æœºå¼•æ“ç«ç„°
                const flameHeight = 10 + Math.random() * 5; // éšæœºç«ç„°é«˜åº¦
                const flameGradient = ctx.createLinearGradient(
                    player.x + player.width / 2, player.y + player.height,
                    player.x + player.width / 2, player.y + player.height + flameHeight
                );
                flameGradient.addColorStop(0, '#ff9900');
                flameGradient.addColorStop(1, '#ff0000');
                
                ctx.fillStyle = flameGradient;
                ctx.beginPath();
                ctx.moveTo(player.x + player.width / 3, player.y + player.height);
                ctx.lineTo(player.x + player.width / 2, player.y + player.height + flameHeight);
                ctx.lineTo(player.x + player.width * 2/3, player.y + player.height);
                ctx.closePath();
                ctx.fill();
            }
        
            // ç»˜åˆ¶å­å¼¹
            bullets.forEach(bullet => {
                // åˆ›å»ºå­å¼¹çš„æ¸å˜è‰²
                const bulletGradient = ctx.createLinearGradient(
                    bullet.x, bullet.y,
                    bullet.x, bullet.y + bullet.height
                );
                
                if (bullet.color === '#FFD700') {
                    // é‡‘è‰²å­å¼¹æ¸å˜
                    bulletGradient.addColorStop(0, '#FFD700');
                    bulletGradient.addColorStop(1, '#FFA500');
                } else {
                    // æ™®é€šå­å¼¹æ¸å˜
                    bulletGradient.addColorStop(0, '#ffffff');
                    bulletGradient.addColorStop(1, '#aaaaaa');
                }
                
                ctx.fillStyle = bulletGradient;
                
                // ç»˜åˆ¶åœ†å½¢å­å¼¹
                ctx.beginPath();
                ctx.ellipse(
                    bullet.x + bullet.width / 2,
                    bullet.y + bullet.height / 2,
                    bullet.width / 2,
                    bullet.height / 2,
                    0, 0, Math.PI * 2
                );
                ctx.fill();
                
                // æ·»åŠ å‘å…‰æ•ˆæœ
                ctx.shadowBlur = 5;
                ctx.shadowColor = bullet.color || '#fff';
                ctx.fill();
                ctx.shadowBlur = 0; // é‡ç½®é˜´å½±
            });
        
            // ç»˜åˆ¶æ•Œæœº
            enemies.forEach(enemy => {
            // æ ¹æ®æ•Œæœºç­‰çº§è®¾ç½®ä¸åŒçš„é¢œè‰²
            let enemyColor;
            switch(enemy.level) {
            case 1:
            ctx.fillStyle = '#f00'; // 1çº§æ•Œæœºä¸ºçº¢è‰²
            break;
            case 2:
            ctx.fillStyle = '#f80'; // 2çº§æ•Œæœºä¸ºæ©™è‰²
            break;
            case 3:
            ctx.fillStyle = '#f0f'; // 3çº§æ•Œæœºä¸ºç´«è‰²
            break;
            default:
            ctx.fillStyle = '#f00';
            }
            
            // ç»˜åˆ¶æ•Œæœºä¸»ä½“ï¼ˆåœ†å½¢ï¼‰
            ctx.beginPath();
            ctx.ellipse(
                enemy.x + enemy.width / 2,
                enemy.y + enemy.height / 2,
                enemy.width / 2,
                enemy.height / 2,
                0, 0, Math.PI * 2
            );
            ctx.fill();
            
            // ç»˜åˆ¶æ•Œæœºç­‰çº§æ•°å­—
            ctx.fillStyle = '#fff';
            ctx.font = 'bold ' + (16 + enemy.level * 2) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(enemy.level, enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
            });
        
            // ç»˜åˆ¶é‡‘è‰²æ–¹å—
            powerUps.forEach(powerUp => {
            // åˆ›å»ºé‡‘è‰²æ–¹å—çš„æ¸å˜
            const powerUpGradient = ctx.createLinearGradient(
                powerUp.x, powerUp.y,
                powerUp.x + powerUp.width, powerUp.y + powerUp.height
            );
            powerUpGradient.addColorStop(0, '#FFD700');
            powerUpGradient.addColorStop(0.5, '#FFC000');
            powerUpGradient.addColorStop(1, '#FFD700');
            
                ctx.fillStyle = powerUpGradient;
                
                // ç»˜åˆ¶é—ªçƒçš„æ˜Ÿå½¢
                const time = Date.now() / 200;
                const scale = 0.9 + Math.sin(time) * 0.1; // è„‰åŠ¨æ•ˆæœ
                
                ctx.save();
                ctx.translate(powerUp.x + powerUp.width / 2, powerUp.y + powerUp.height / 2);
                ctx.scale(scale, scale);
                
                drawStar(0, 0, powerUp.width / 2, 5);
                
                ctx.restore();
            });
        
            // ç»˜åˆ¶è“è‰²æ–¹å—ï¼ˆæ— æ•Œå¥–åŠ±ï¼‰
            invinciblePowerUps.forEach(powerUp => {
            // åˆ›å»ºè“è‰²æ–¹å—çš„æ¸å˜
            const invincibleGradient = ctx.createLinearGradient(
                powerUp.x, powerUp.y,
                powerUp.x + powerUp.width, powerUp.y + powerUp.height
            );
            invincibleGradient.addColorStop(0, '#00BFFF');
            invincibleGradient.addColorStop(0.5, '#0080FF');
            invincibleGradient.addColorStop(1, '#00BFFF');
            
                ctx.fillStyle = invincibleGradient;
                
                // ç»˜åˆ¶é—ªçƒçš„ç›¾ç‰Œå½¢çŠ¶
                const time = Date.now() / 200;
                const scale = 0.9 + Math.sin(time) * 0.1; // è„‰åŠ¨æ•ˆæœ
                
                ctx.save();
                ctx.translate(powerUp.x + powerUp.width / 2, powerUp.y + powerUp.height / 2);
                ctx.scale(scale, scale);
                
                drawShield(0, 0, powerUp.width / 2);
                
                ctx.restore();
            });
            
            // ç»˜åˆ¶çˆ†ç‚¸æ•ˆæœ
            explosions.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        
            // æ˜¾ç¤ºæš‚åœçŠ¶æ€
            if (gamePaused && !gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶æš‚åœæ–‡å­—
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆæš‚åœ', canvas.width / 2, canvas.height / 2);
                
                // ç»˜åˆ¶ç»§ç»­æç¤º
                ctx.font = '24px Arial';
                ctx.fillText('æŒ‰ç©ºæ ¼é”®ç»§ç»­', canvas.width / 2, canvas.height / 2 + 40);
                
                // ç»˜åˆ¶æš‚åœå›¾æ ‡
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(canvas.width / 2, canvas.height / 2 - 80, 40, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.fillStyle = '#fff';
                ctx.fillRect(canvas.width / 2 - 15, canvas.height / 2 - 100, 10, 40);
                ctx.fillRect(canvas.width / 2 + 5, canvas.height / 2 - 100, 10, 40);
            }
        
            // æ¸¸æˆç»“æŸ
            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶æ¸¸æˆç»“æŸæ–‡å­—
                ctx.fillStyle = '#ff0000';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆç»“æŸ', canvas.width / 2, canvas.height / 2 - 50);
                
                // ç»˜åˆ¶å¾—åˆ†ä¿¡æ¯
                ctx.fillStyle = '#fff';
                ctx.font = '24px Arial';
                ctx.fillText(`æœ€ç»ˆå¾—åˆ†: ${score}`, canvas.width / 2, canvas.height / 2);
                ctx.fillText(`å‡»æ€æ•°: ${kills}`, canvas.width / 2, canvas.height / 2 + 30);
                ctx.fillText(`æ¸¸æˆæ—¶é—´: ${gameTime}ç§’`, canvas.width / 2, canvas.height / 2 + 60);
                
                // ç»˜åˆ¶é‡æ–°å¼€å§‹æç¤º
                ctx.fillStyle = '#4a90e2';
                ctx.fillText('æŒ‰ç©ºæ ¼é”®é‡æ–°å¼€å§‹', canvas.width / 2, canvas.height / 2 + 100);
            }
        }

        // æ›´æ–°æ¸¸æˆæ—¶é—´
        function updateTime() {
            if (!gameOver) {
                gameTime = Math.floor((Date.now() - startTime) / 1000);
                timeElement.textContent = gameTime;
            }
        }

        // åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
        function createExplosion(x, y, size, color) {
            const particleCount = 20 + Math.floor(size / 5);
            
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 1 + Math.random() * 3;
                const radius = 1 + Math.random() * 3;
                const life = 30 + Math.random() * 20;
                
                explosions.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    radius: radius,
                    color: color,
                    life: life,
                    maxLife: life
                });
            }
        }
        
        // æ›´æ–°çˆ†ç‚¸æ•ˆæœ
        function updateExplosions() {
            explosions = explosions.filter(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                return particle.life > 0;
            });
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            if (!gameOver && !gamePaused) {
                updatePlayer();
                createBullet();
                updateBullets();
                createEnemy();
                updateEnemies();
                createPowerUp();
                createInvinciblePowerUp();
                updatePowerUps();
                updateInvinciblePowerUps(); 
                updateExplosions(); // æ›´æ–°çˆ†ç‚¸æ•ˆæœ
                checkCollisions();
                updateTime();
            } else if (gameOver && keys.Space) {
                // é‡ç½®æ¸¸æˆ
                score = 0;
                lives = 3;
                kills = 0;
                gameTime = 0;
                startTime = Date.now();
                enemyCounter = 0; // é‡ç½®æ•Œäººè®¡æ•°å™¨
                scoreElement.textContent = score;
                livesElement.textContent = lives;
                killsElement.textContent = kills;
                timeElement.textContent = gameTime;
                player.x = canvas.width / 2;
                player.invincible = false;
                powerUpActive = false;
                powerUpTimeLeft = 0;
                bullets = [];
                enemies = [];
                powerUps = [];
                gameOver = false;
                gamePaused = false;
            }

            // ç»˜åˆ¶æ¸¸æˆç”»é¢
            draw();

            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }

        // å¼€å§‹æ¸¸æˆ
        gameLoop();

        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // è°ƒæ•´ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            const maxWidth = window.innerWidth - 20;
            const maxHeight = window.innerHeight - 150;
            const ratio = 400 / 600;

            let newWidth = maxWidth;
            let newHeight = maxWidth / ratio;

            if (newHeight > maxHeight) {
                newHeight = maxHeight;
                newWidth = maxHeight * ratio;
            }

            canvas.width = newWidth;
            canvas.height = newHeight;

            // è°ƒæ•´ç©å®¶ä½ç½®
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;
        }

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // ç§»åŠ¨è®¾å¤‡æ§åˆ¶
        if (isMobile) {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const fireBtn = document.getElementById('fireBtn');
            
            // ä¿®æ”¹å‘å°„æŒ‰é’®ä¸ºæš‚åœæŒ‰é’®
            fireBtn.innerHTML = 'â¸ï¸';
        
            // è§¦æ‘¸æ§åˆ¶
            const handleTouchStart = (e, key) => {
                e.preventDefault();
                e.stopPropagation(); // æ·»åŠ è¿™ä¸€è¡Œé˜»æ­¢äº‹ä»¶å†’æ³¡
                
                if (key === 'Space') {
                    // ç©ºæ ¼é”®ç”¨äºæš‚åœ/ç»§ç»­æ¸¸æˆ
                    if (!gameOver) {
                        gamePaused = !gamePaused;
                        
                        // å¦‚æœç»§ç»­æ¸¸æˆï¼Œæ›´æ–°å¼€å§‹æ—¶é—´ä»¥é¿å…æ—¶é—´è·³è·ƒ
                        if (!gamePaused) {
                            const pauseDuration = Date.now() - pauseStartTime;
                            startTime += pauseDuration;
                        } else {
                            // è®°å½•æš‚åœå¼€å§‹æ—¶é—´
                            pauseStartTime = Date.now();
                        }
                    }
                } else {
                    keys[key] = true;
                }
            };
        
            const handleTouchEnd = (e, key) => {
                e.preventDefault();
                e.stopPropagation(); // æ·»åŠ è¿™ä¸€è¡Œé˜»æ­¢äº‹ä»¶å†’æ³¡
                keys[key] = false;
            };
        
            leftBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'ArrowLeft'));
            leftBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'ArrowLeft'));
        
            rightBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'ArrowRight'));
            rightBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'ArrowRight'));
        
            fireBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'Space'));
            fireBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'Space'));
        
            // æ·»åŠ è§¦æ‘¸å–æ¶ˆäº‹ä»¶å¤„ç†
            leftBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'ArrowLeft'));
            rightBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'ArrowRight'));
            fireBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'Space'));
        
            // éšè—ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾
            document.documentElement.addEventListener('touchstart', (e) => {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            // ç¦æ­¢é¡µé¢æ»šåŠ¨
            document.body.addEventListener('touchmove', (e) => {
                e.preventDefault();
            }, { passive: false });
        } else {
            // åœ¨éç§»åŠ¨è®¾å¤‡ä¸Šéšè—æ§åˆ¶æŒ‰é’®
            document.getElementById('mobileControls').style.display = 'none';
        }
    </script>
</body>
</html>

<style>
    #lastModified {
        position: fixed;
        top: 10px;
        right: 10px;
        color: #fff;
        font-size: 14px;
        font-family: Arial, sans-serif;
        background: rgba(0, 0, 0, 0.5);
        padding: 5px 10px;
        border-radius: 5px;
        z-index: 100;
    }
</style>

<!-- åœ¨ gameInfo div åæ·»åŠ  -->
<div id="lastModified"></div>

<script>
// åœ¨æ¸¸æˆå¾ªç¯å¼€å§‹å‰æ·»åŠ 
const lastModifiedElement = document.getElementById('lastModified');

// è·å–å¹¶æ˜¾ç¤ºæœ€åä¿®æ”¹æ—¶é—´
fetch(window.location.href)
    .then(response => {
        const lastModified = response.headers.get('last-modified');
        if (lastModified) {
            const date = new Date(lastModified);
            const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            const formattedTime = `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
            lastModifiedElement.textContent = `æœ€åæ›´æ–°: ${formattedDate} ${formattedTime}`;
        } else {
            lastModifiedElement.textContent = 'æœ€åæ›´æ–°æ—¶é—´æœªçŸ¥';
        }
    })
    .catch(() => {
        lastModifiedElement.textContent = 'æœ€åæ›´æ–°æ—¶é—´æœªçŸ¥';
    });
</script>
