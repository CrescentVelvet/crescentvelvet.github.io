---
permalink: /enc_reader.html
layout: null
title: "加密日志阅读器"
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密日志阅读器</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 700px;
            margin: 40px auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 24px rgba(60,60,120,0.08);
            padding: 32px 24px 24px 24px;
        }
        h1 {
            text-align: center;
            color: #4a90e2;
            margin-bottom: 30px;
        }
        .file-list {
            margin-bottom: 20px;
        }
        .file-list label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 15px;
        }
        .input-group {
            margin-bottom: 18px;
        }
        input[type="password"] {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 15px;
        }
        button {
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 10px 24px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 8px;
            transition: background 0.2s;
        }
        button:hover {
            background: #357ab8;
        }
        .output {
            margin-top: 24px;
            background: #f4f8fb;
            border-radius: 6px;
            padding: 18px;
            min-height: 120px;
            font-size: 15px;
            color: #222;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .preview-content {
            font-family: "幼圆", "圆体-简-细体", "Times New Roman", serif;
            font-size: 10.5pt;
            text-indent: 2em;
            line-height: 1.0;
            margin-top: 0;
            margin-bottom: 0;
        }
        .leisure-highlight {
            color: #d35f05;
            font-weight: bold;
        }
        .dream-highlight {
            color: #8A2BE2;
            font-weight: bold;
        }
        .video-highlight {
            color: #0056b3;
            font-weight: bold;
        }
        .review-highlight {
            color: #e67e22;
            background: #fffbe6;
            border-left: 4px solid #e67e22;
            padding-left: 8px;
        }
        .date-highlight {
            font-weight: bold;
            color: #0056b3;
            padding: 2px 0;
            font-size: 20px;
        }
        .error {
            color: #dc3545;
            margin-top: 10px;
        }
        .success {
            color: #28a745;
            margin-top: 10px;
        }
        .toc {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px 18px;
            margin-bottom: 18px;
            font-size: 15px;
        }
        .toc-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4a90e2;
        }
        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .toc-list li {
            margin-bottom: 6px;
        }
        .toc-link {
            color: #4a90e2;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
        }
        .toc-link:hover {
            color: #d35f05;
        }
        .toc-highlight {
            background: #ffe9b3 !important;
            transition: background 0.6s;
        }
        .word-count {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: right;
        }
        .search-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        #searchInput {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 15px;
        }
        #searchBtn {
            padding: 6px 18px;
            border: none;
            border-radius: 4px;
            background: #4a90e2;
            color: #fff;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        #searchBtn:hover {
            background: #357ab8;
        }
        .search-highlight {
            background: #ffe066;
            color: #d35f05;
            border-radius: 2px;
            padding: 0 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>加密日志阅读器</h1>
        <div id="word-count" class="word-count"></div>
        <div id="toc" class="toc"></div>
        <div class="file-list">
            <label for="fileSelect">选择日志文件：</label>
            <select id="fileSelect"></select>
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="请输入解密密码">
        </div>
        <button id="decryptBtn">解密并显示</button>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="搜索日志内容..." />
            <button id="searchBtn">搜索</button>
        </div>
        <div id="status"></div>
        <div class="output" id="output"></div>
    </div>
    <script src="/assets/js/crypto-js.min.js"></script>
    <script>
    window.files = [
        {% for file in site.static_files %}
        {% if file.path contains '/assets/data/' and file.extname == '.txt' %}
            '{{ file.name }}',
        {% endif %}
        {% endfor %}
    ];
    </script>
    <script>
    window.files = window.files.filter(f => f && f.trim());
    const fileSelect = document.getElementById('fileSelect');
    window.files.forEach(f => {
        const opt = document.createElement('option');
        opt.value = f;
        opt.textContent = f;
        fileSelect.appendChild(opt);
    });
    </script>
    <script>
    document.getElementById('decryptBtn').onclick = async function() {
        const file = fileSelect.value;
        const password = document.getElementById('password').value;
        const status = document.getElementById('status');
        const output = document.getElementById('output');
        status.textContent = '';
        output.textContent = '';
        if (!file) {
            status.textContent = '请选择文件';
            status.className = 'error';
            return;
        }
        if (!password) {
            status.textContent = '请输入密码';
            status.className = 'error';
            return;
        }
        try {
            const res = await fetch(`/assets/data/${file}`);
            if (!res.ok) throw new Error('文件读取失败');
            const ciphertext = await res.text();
            const bytes = CryptoJS.AES.decrypt(ciphertext, password);
            const decrypted = bytes.toString(CryptoJS.enc.Utf8);
            if (!decrypted) {
                status.textContent = '密码错误或文件损坏';
                status.className = 'error';
                return;
            }
            status.textContent = '解密成功';
            status.className = 'success';
            output.innerHTML = decrypted;
            generateTOC();
            updateWordCount();
        } catch (e) {
            status.textContent = '解密失败：' + e.message;
            status.className = 'error';
        }
    };
    </script>
    <script>
    // 自动生成目录（TOC）并支持跳转
    function generateTOC() {
        const output = document.getElementById('output');
        const toc = document.getElementById('toc');
        toc.innerHTML = '<div class="toc-title">目录</div>';
        const list = document.createElement('ul');
        list.className = 'toc-list';

        // 选取所有有色段落
        const selectors = [
            {cls: 'date-highlight', label: '日期'},
            {cls: 'dream-highlight', label: '梦幻空花'},
            {cls: 'leisure-highlight', label: '闲情逸致'},
            {cls: 'video-highlight', label: '做视频想法'}
        ];
        let idx = 0;
        selectors.forEach(sel => {
            output.querySelectorAll('.' + sel.cls).forEach(el => {
                idx++;
                // 生成唯一id
                const id = `toc-anchor-${sel.cls}-${idx}`;
                el.id = id;
                // 目录项文本
                let text = el.textContent.trim();
                if (text.length > 20) text = text.slice(0, 20) + '...';
                const li = document.createElement('li');
                li.innerHTML = `<span class="toc-link" data-target="${id}">${text}</span>`;
                list.appendChild(li);
            });
        });
        if (list.children.length === 0) {
            toc.style.display = 'none';
        } else {
            toc.style.display = '';
            toc.appendChild(list);
        }

        // 目录点击跳转
        toc.querySelectorAll('.toc-link').forEach(link => {
            link.onclick = function() {
                const target = document.getElementById(this.getAttribute('data-target'));
                if (target) {
                    target.scrollIntoView({behavior: 'smooth', block: 'center'});
                    target.classList.add('toc-highlight');
                    setTimeout(() => target.classList.remove('toc-highlight'), 1200);
                }
            };
        });
    }
    </script>
    <script>
    // 自动统计总字数
    function updateWordCount() {
        const output = document.getElementById('output');
        const wordCountDiv = document.getElementById('word-count');
        // 获取纯文本内容，去除所有HTML标签
        const text = output.innerText || output.textContent || '';
        // 统计所有非空字符数
        const count = text.replace(/\s/g, '').length;
        wordCountDiv.textContent = `总字数：${count}`;
    }
    </script>
    <script>
    // 文字搜索功能
    document.getElementById('searchBtn').onclick = function() {
        const keyword = document.getElementById('searchInput').value.trim();
        const output = document.getElementById('output');
        clearSearchHighlight(output);
        if (!keyword) return;
        highlightKeyword(output, keyword);
    };

    function highlightKeyword(container, keyword) {
        if (!keyword) return;
        // 遍历所有文本节点，进行高亮
        const treeWalker = document.createTreeWalker(
            container,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );
        const nodes = [];
        while (treeWalker.nextNode()) {
            nodes.push(treeWalker.currentNode);
        }
        nodes.forEach(node => {
            const idx = node.nodeValue.toLowerCase().indexOf(keyword.toLowerCase());
            if (idx > -1 && node.nodeValue.trim() !== '') {
                const span = document.createElement('span');
                const before = node.nodeValue.slice(0, idx);
                const match = node.nodeValue.slice(idx, idx + keyword.length);
                const after = node.nodeValue.slice(idx + keyword.length);
                span.innerHTML = `${before}<span class="search-highlight">${match}</span>${after}`;
                node.parentNode.replaceChild(span, node);
            }
        });
    }

    function clearSearchHighlight(container) {
        // 移除所有高亮
        const highlights = container.querySelectorAll('.search-highlight');
        highlights.forEach(span => {
            const parent = span.parentNode;
            parent.replaceChild(document.createTextNode(span.textContent), span);
            parent.normalize();
        });
    }
    </script>
</body>
</html> 