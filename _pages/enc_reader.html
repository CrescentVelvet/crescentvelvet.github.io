---
permalink: /enc_reader.html
layout: null
title: "加密日志阅读器"
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密日志阅读器</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 700px;
            margin: 40px auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 24px rgba(60,60,120,0.08);
            padding: 32px 24px 24px 24px;
        }
        h1 {
            text-align: center;
            color: #4a90e2;
            margin-bottom: 30px;
        }
        .file-list {
            margin-bottom: 20px;
        }
        .file-list label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 15px;
        }
        .input-group {
            margin-bottom: 18px;
        }
        input[type="password"] {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 15px;
        }
        button {
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 10px 24px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 8px;
            transition: background 0.2s;
        }
        button:hover {
            background: #357ab8;
        }
        .output {
            margin-top: 24px;
            background: #f4f8fb;
            border-radius: 6px;
            padding: 18px;
            min-height: 120px;
            font-size: 15px;
            color: #222;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .preview-content {
            font-family: "幼圆", "圆体-简-细体", "Times New Roman", serif;
            font-size: 10.5pt;
            text-indent: 2em;
            line-height: 1.0;
            margin-top: 0;
            margin-bottom: 0;
        }
        .leisure-highlight {
            color: #d35f05;
            font-weight: bold;
        }
        .dream-highlight {
            color: #8A2BE2;
            font-weight: bold;
        }
        .video-highlight {
            color: #0056b3;
            font-weight: bold;
        }
        .review-highlight {
            color: #e67e22;
            background: #fffbe6;
            border-left: 4px solid #e67e22;
            padding-left: 8px;
        }
        .date-highlight {
            font-weight: bold;
            color: #0056b3;
            padding: 2px 0;
            font-size: 20px;
        }
        .error {
            color: #dc3545;
            margin-top: 10px;
        }
        .success {
            color: #28a745;
            margin-top: 10px;
        }
        .toc {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px 18px;
            margin-bottom: 18px;
            font-size: 15px;
        }
        .toc-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4a90e2;
        }
        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .toc-list li {
            margin-bottom: 6px;
        }
        .toc-link {
            color: #4a90e2;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
        }
        .toc-link:hover {
            color: #d35f05;
        }
        .toc-highlight {
            background: #ffe9b3 !important;
            transition: background 0.6s;
        }
        .word-count {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: right;
        }
        .search-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        #searchInput {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 15px;
        }
        #searchBtn {
            padding: 6px 18px;
            border: none;
            border-radius: 4px;
            background: #4a90e2;
            color: #fff;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        #searchBtn:hover {
            background: #357ab8;
        }
        .search-highlight {
            background: #ffe066;
            color: #d35f05;
            border-radius: 2px;
            padding: 0 2px;
        }
        .format-btn { border:none; border-radius:6px; padding:6px 14px; font-size:15px; cursor:pointer; font-weight:500; transition:background 0.2s; }
        .btn-normal { background:#f4f8fb; color:#222; }
        .btn-leisure { background:#fffbe6; color:#d35f05; }
        .btn-dream { background:#f3e6ff; color:#8A2BE2; }
        .btn-video { background:#e6f0ff; color:#0056b3; }
        .btn-review { background:#ffe9b3; color:#e67e22; border-left:4px solid #e67e22; }
        .format-btn:hover { filter:brightness(0.95); }
        .sticky-toolbar {
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
            padding-top: 8px;
            padding-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>加密日志阅读器</h1>
        <div id="word-count" class="word-count"></div>
        <div id="toc-container" style="margin-bottom:10px;">
            <button id="toggleTocBtn" style="margin-bottom:4px;">展开目录</button>
            <div id="toc" class="toc" style="display:none;"></div>
        </div>
        <div class="file-list">
            <label for="fileSelect">选择日志文件：</label>
            <select id="fileSelect"></select>
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="请输入解密密码">
        </div>
        <button id="decryptBtn">解密并显示</button>
        <button id="exportBtn" style="margin-top:12px;">导出加密日志</button>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="搜索日志内容..." />
            <button id="searchBtn">搜索</button>
        </div>
        <div class="sticky-toolbar">
            <button type="button" class="format-btn btn-normal" onclick="formatSelection('normal')">原始文本</button>
            <button type="button" class="format-btn btn-leisure" onclick="formatSelection('leisure-highlight')">闲情逸致</button>
            <button type="button" class="format-btn btn-dream" onclick="formatSelection('dream-highlight')">梦幻空花</button>
            <button type="button" class="format-btn btn-review" onclick="formatSelection('review-highlight')">未来回顾</button>
            <button type="button" class="format-btn btn-video" onclick="formatSelection('video-highlight')">做视频想法</button>
            <button type="button" class="format-btn btn-normal" onclick="oneKeyFormat()">一键格式化</button>
        </div>
        <div id="status"></div>
        <div class="output" id="output" contenteditable="true" spellcheck="false"></div>
    </div>
    <script src="/assets/js/crypto-js.min.js"></script>
    <script>
    window.files = [
        {% for file in site.static_files %}
        {% if file.path contains '/assets/data/' and file.extname == '.txt' %}
            '{{ file.name }}',
        {% endif %}
        {% endfor %}
    ];
    </script>
    <script>
    window.files = window.files.filter(f => f && f.trim());
    const fileSelect = document.getElementById('fileSelect');
    window.files.forEach(f => {
        const opt = document.createElement('option');
        opt.value = f;
        opt.textContent = f;
        fileSelect.appendChild(opt);
    });
    </script>
    <script>
    document.getElementById('decryptBtn').onclick = async function() {
        const file = fileSelect.value;
        const password = document.getElementById('password').value;
        const status = document.getElementById('status');
        const output = document.getElementById('output');
        status.textContent = '';
        output.textContent = '';
        if (!file) {
            status.textContent = '请选择文件';
            status.className = 'error';
            return;
        }
        if (!password) {
            status.textContent = '请输入密码';
            status.className = 'error';
            return;
        }
        try {
            const res = await fetch(`/assets/data/${file}`);
            if (!res.ok) throw new Error('文件读取失败');
            const ciphertext = await res.text();
            const bytes = CryptoJS.AES.decrypt(ciphertext, password);
            const decrypted = bytes.toString(CryptoJS.enc.Utf8);
            if (!decrypted) {
                status.textContent = '密码错误或文件损坏';
                status.className = 'error';
                return;
            }
            status.textContent = '解密成功';
            status.className = 'success';
            output.innerHTML = decrypted;
            generateTOC();
            updateWordCount();
        } catch (e) {
            status.textContent = '解密失败：' + e.message;
            status.className = 'error';
        }
    };
    </script>
    <script>
    // 自动生成目录（TOC）并支持跳转
    function generateTOC() {
        const output = document.getElementById('output');
        const toc = document.getElementById('toc');
        toc.innerHTML = '<div class="toc-title">目录</div>';
        const list = document.createElement('ul');
        list.className = 'toc-list';

        // 选取所有有色段落
        const selectors = [
            {cls: 'date-highlight', label: '日期'},
            {cls: 'dream-highlight', label: '梦幻空花'},
            {cls: 'leisure-highlight', label: '闲情逸致'},
            {cls: 'video-highlight', label: '做视频想法'}
        ];
        let idx = 0;
        selectors.forEach(sel => {
            output.querySelectorAll('.' + sel.cls).forEach(el => {
                idx++;
                // 生成唯一id
                const id = `toc-anchor-${sel.cls}-${idx}`;
                el.id = id;
                // 目录项文本
                let text = el.textContent.trim();
                if (text.length > 20) text = text.slice(0, 20) + '...';
                const li = document.createElement('li');
                li.innerHTML = `<span class="toc-link" data-target="${id}">${text}</span>`;
                list.appendChild(li);
            });
        });
        if (list.children.length === 0) {
            toc.style.display = 'none';
        } else {
            toc.style.display = '';
            toc.appendChild(list);
        }

        // 目录点击跳转
        toc.querySelectorAll('.toc-link').forEach(link => {
            link.onclick = function() {
                const target = document.getElementById(this.getAttribute('data-target'));
                if (target) {
                    target.scrollIntoView({behavior: 'smooth', block: 'center'});
                    target.classList.add('toc-highlight');
                    setTimeout(() => target.classList.remove('toc-highlight'), 1200);
                }
            };
        });
        // 强制目录收起
        toc.style.display = 'none';
        var btn = document.getElementById('toggleTocBtn');
        if(btn) btn.textContent = '展开目录';
    }
    </script>
    <script>
    // 自动统计总字数
    function updateWordCount() {
        const output = document.getElementById('output');
        const wordCountDiv = document.getElementById('word-count');
        // 获取纯文本内容，去除所有HTML标签
        const text = output.innerText || output.textContent || '';
        // 统计所有非空字符数
        const count = text.replace(/\s/g, '').length;
        wordCountDiv.textContent = `总字数：${count}`;
    }
    </script>
    <script>
    // 文字搜索功能
    document.getElementById('searchBtn').onclick = function() {
        const keyword = document.getElementById('searchInput').value.trim();
        const output = document.getElementById('output');
        clearSearchHighlight(output);
        if (!keyword) return;
        highlightKeyword(output, keyword);
    };

    function highlightKeyword(container, keyword) {
        if (!keyword) return;
        // 遍历所有文本节点，进行高亮
        const treeWalker = document.createTreeWalker(
            container,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );
        const nodes = [];
        while (treeWalker.nextNode()) {
            nodes.push(treeWalker.currentNode);
        }
        nodes.forEach(node => {
            const idx = node.nodeValue.toLowerCase().indexOf(keyword.toLowerCase());
            if (idx > -1 && node.nodeValue.trim() !== '') {
                const span = document.createElement('span');
                const before = node.nodeValue.slice(0, idx);
                const match = node.nodeValue.slice(idx, idx + keyword.length);
                const after = node.nodeValue.slice(idx + keyword.length);
                span.innerHTML = `${before}<span class="search-highlight">${match}</span>${after}`;
                node.parentNode.replaceChild(span, node);
            }
        });
    }

    function clearSearchHighlight(container) {
        // 移除所有高亮
        const highlights = container.querySelectorAll('.search-highlight');
        highlights.forEach(span => {
            const parent = span.parentNode;
            parent.replaceChild(document.createTextNode(span.textContent), span);
            parent.normalize();
        });
    }
    </script>
    <script>
    // 导出加密日志
    document.getElementById('exportBtn').onclick = function() {
        const file = document.getElementById('fileSelect').value;
        const password = document.getElementById('password').value;
        const status = document.getElementById('status');
        const output = document.getElementById('output');
        if (!file) {
            status.textContent = '请选择文件';
            status.className = 'error';
            return;
        }
        if (!password) {
            status.textContent = '请输入密码';
            status.className = 'error';
            return;
        }
        // 获取富文本内容
        const htmlContent = output.innerHTML;
        try {
            const ciphertext = CryptoJS.AES.encrypt(htmlContent, password).toString();
            const blob = new Blob([ciphertext], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = file;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            status.textContent = '加密导出成功';
            status.className = 'success';
        } catch (e) {
            status.textContent = '加密导出失败：' + e.message;
            status.className = 'error';
        }
    };
    </script>
    <script>
    function formatSelection(type) {
        const output = document.getElementById('output');
        const sel = window.getSelection();
        if (!sel.rangeCount) return;
        const range = sel.getRangeAt(0);
        if (!output.contains(range.commonAncestorContainer)) return;
        let span = document.createElement('span');
        if (type === 'normal') {
            // 还原为普通文本
            const text = range.toString();
            range.deleteContents();
            range.insertNode(document.createTextNode(text));
            return;
        }
        span.className = type;
        span.textContent = range.toString();
        range.deleteContents();
        range.insertNode(span);
    }
    </script>
    <script>
    // 一键格式化按钮逻辑，参考 text_processor.html
    function oneKeyFormat() {
        const output = document.getElementById('output');
        let html = output.innerHTML;
        // 1. 去除多余标签，仅保留文本和换行
        let tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        let text = tempDiv.innerText;
        // 2. 按行分割，处理段落
        let lines = text.split(/\r?\n/);
        let formatted = lines.map(line => {
            if (!line.trim()) return '';
            // 日期高亮
            if (/^\d{4}[-/]\d{1,2}[-/]\d{1,2}$/.test(line.trim())) {
                return `<span class="date-highlight">${line.trim()}</span><br>`;
            }
            // 未来回顾
            if (/^（\d{4}\.\d{2}\.\d{2}回顾：/.test(line.trim())) {
                return `<span class="review-highlight">${line.trim()}</span><br>`;
            }
            // 闲情逸致
            if (/^今天都做了些什么/.test(line.trim()) || /^闲情逸致：/.test(line.trim())) {
                return `<span class="leisure-highlight">${line.trim()}</span><br>`;
            }
            // 梦幻空花
            if (/^梦幻空花：/.test(line.trim())) {
                return `<span class="dream-highlight">${line.trim()}</span><br>`;
            }
            // 做视频想法
            if (/^做视频想法：/.test(line.trim())) {
                return `<span class="video-highlight">${line.trim()}</span><br>`;
            }
            return `${line.trim()}<br>`;
        }).join('');
        // 3. 去除多余空行
        formatted = formatted.replace(/(<br>\s*){2,}/g, '<br>');
        output.innerHTML = formatted;
    }
    </script>
    <script>
    // 目录折叠/展开逻辑
    const tocDiv = document.getElementById('toc');
    const toggleTocBtn = document.getElementById('toggleTocBtn');
    toggleTocBtn.onclick = function() {
        if (tocDiv.style.display === 'none') {
            tocDiv.style.display = '';
            toggleTocBtn.textContent = '收起目录';
        } else {
            tocDiv.style.display = 'none';
            toggleTocBtn.textContent = '展开目录';
        }
    };
    </script>
</body>
</html> 